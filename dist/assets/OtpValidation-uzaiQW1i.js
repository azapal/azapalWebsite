import{r as g,C as D,G as M,o as A,D as E,w as j,c as v,k as m,b as i,l as z,F as K,q as L,z as q,A as N,v as S,p as G,I as H}from"./index-DTq0z6UM.js";import{u as J,a as Q,S as W,n as b}from"./storeUtils-BBgzQjYe.js";import{a as X}from"./authenticationRequest-gtOJk9va.js";const Y={class:"fixed w-full h-full bg-gray z-40 bg-black/50 flex items-center justify-center p-4"},Z={class:"bg-white rounded-lg p-6 w-full max-w-md"},ee={class:"mb-6"},te={class:"flex justify-center flex-wrap gap-2 sm:gap-3"},se=["id","onUpdate:modelValue","onInput","onKeydown"],oe={key:0,class:"text-red-500 mt-2 text-center"},ae={class:"space-y-3"},ne={key:0,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"},le=["disabled"],re={class:"text-center"},ie=["disabled"],pe={__name:"OtpValidation",props:{page:String,data:null},setup(I){const n=I,l=g(["","","","",""]),p=g([]),y=g(!1),f=g(""),u=W,O=J(),C=Q(),{isVerificationDone:V,getLoading:ue}=D(O),{isBusinessVerificationDone:T}=D(C),c=g(120);let h=null;const w=M(()=>l.value.every(t=>t!=="")),x=async()=>{await u.dispatch("auth","signUp",n.data),u.commit("auth","showOtpScreen",!1)},B=t=>{const s=Math.floor(t/60),r=t%60;return`${s}:${r.toString().padStart(2,"0")}`},_=()=>{c.value=20,clearInterval(h),h=setInterval(()=>{c.value>0?c.value--:clearInterval(h)},1e3)},d=t=>{p.value&&p.value[t]&&H(()=>{p.value[t].focus(),p.value[t].select()})};A(()=>{setTimeout(()=>{d(0)},100),_()}),E(()=>{clearInterval(h)});const P=t=>{f.value="",l.value[t]=l.value[t].replace(/[^0-9]/g,""),l.value[t]!==""&&t<4&&d(t+1)},R=(t,s)=>{t.key==="Backspace"&&l.value[s]===""&&s>0&&(l.value[s-1]="",d(s-1)),t.key==="ArrowLeft"&&s>0&&d(s-1),t.key==="ArrowRight"&&s<4&&d(s+1)},U=t=>{t.preventDefault();const s=(t.clipboardData||window.clipboardData).getData("text");if(/^\d+$/.test(s)){const r=s.substring(0,5).split("");r.forEach((o,k)=>{k<6&&(l.value[k]=o)});const a=Math.min(r.length,5)-1;a>=0&&d(a),r.length>=6&&d(5),f.value=""}else f.value="Please paste numeric digits only"},$=async()=>{var t,s;if(y.value=!0,w.value){const r=l.value.join("");if(n.page==="signup"&&await u.dispatch("auth","verifyInitiatingOtp",{otp:r,email:(t=n==null?void 0:n.data)==null?void 0:t.email}),n.page==="business"&&await u.dispatch("auth","verifyOtp",r),n.page==="login")try{const o=(await u.dispatch("auth","verifyEmailOtp",{otp:r,email:(s=n==null?void 0:n.data)==null?void 0:s.email})).data;o.response_code==="00"?(u.commit("auth","showOtpScreen",!1),u.commit("auth","verificationDone",!0),b(o.response_message,"success")):b(o.response_message,"error")}catch{b(e,"error")}y.value=!1}},F=()=>{c.value>0||(console.log("Resending OTP..."),l.value=["","","","",""],f.value="",d(0),_(),u.dispatch("auth","sendOtp",X))};return j(()=>[V.value,T.value],([t,s],[r,a])=>{console.log(t),t&&n.page==="signup"&&x()}),(t,s)=>(m(),v("div",Y,[i("div",Z,[s[3]||(s[3]=i("div",{class:"text-center mb-6"},[i("h2",{class:"text-2xl font-bold text-gray-800"},"Verification Code"),i("p",{class:"text-gray-600 mt-2"}," Please enter the 5-digit verification code sent to your device ")],-1)),i("div",ee,[s[2]||(s[2]=i("label",{for:"otp-input",class:"sr-only"},"Enter OTP",-1)),i("div",te,[(m(),v(K,null,L(5,(r,a)=>q(i("input",{key:a,id:`otp-input-${a}`,ref_for:!0,ref_key:"inputRefs",ref:p,type:"text",inputmode:"numeric",pattern:"[0-9]*",maxlength:"1","onUpdate:modelValue":o=>l.value[a]=o,onInput:o=>P(a),onKeydown:o=>R(o,a),onPaste:U,onFocus:s[0]||(s[0]=o=>o.target.select()),onClick:s[1]||(s[1]=o=>o.target.select()),class:"w-12 h-12 sm:w-14 sm:h-14 text-center text-xl font-semibold border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500"},null,40,se),[[N,l.value[a]]])),64))]),f.value?(m(),v("p",oe,S(f.value),1)):z("",!0)]),i("div",ae,[y.value?(m(),v("div",ne)):(m(),v("button",{key:1,onClick:$,disabled:!w.value,class:"w-full py-3 bg-orange-500 text-white rounded-md font-medium hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{"background-color":"#F97316"}}," verify ",8,le)),i("div",re,[i("button",{onClick:F,disabled:c.value>0,class:G(["text-orange-500 hover:text-orange-700 font-medium focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed",{"opacity-50 cursor-not-allowed":c.value>0}]),style:{color:"#F97316"}},S(c.value>0?`Resend Code in ${B(c.value)}`:"Resend Code"),11,ie)])])])]))}};export{pe as _};
